# IPS 시스템 데이터 분석 보고서

## 분석 개요

현재 IPS 시스템의 데이터 구조 및 품질을 분석하여 재설계 방향을 결정합니다.

## 현재 데이터 상태

### **데이터 파일 현황**
```
발견된 데이터:
├── random_forest_model.pkl (기존 학습된 모델)
├── captured_packets_*.csv (사용자가 수동 삭제)
├── data_set/전처리데이터1.csv (존재하지 않음)
└── 로그 데이터 (defense_actions.log, ips_debug.log)

결론: 분석할 훈련 데이터 부족
```

### **추정되는 데이터 구조**
```python
# ml_models.py 코드 분석 기반 추정
현재 특성:
├── 'source': 출발지 IP
├── 'destination': 목적지 IP  
├── 'protocol': 프로토콜 번호/이름
├── 'length': 패킷 크기
├── 'ttl': Time To Live
└── 'flags': TCP 플래그

현재 타겟:
├── 'protocol_6': TCP 프로토콜 여부 (0/1)
└── 문제: 공격/정상 분류가 아님
```

## 문제점 분석

### **1. 레이블 문제**
```
현재 상황:
├── 타겟이 'protocol_6' (TCP 여부)
├── 실제 필요: 공격/정상 분류
├── 위협 수준 정보 부족
└── 공격 유형 분류 없음

개선 필요:
├── is_malicious (0: 정상, 1: 공격)
├── threat_level (low/medium/high)
├── attack_type (port_scan, ddos, etc.)
└── confidence_score (탐지 신뢰도)
```

### **2. 특성 한계**
```
현재 특성의 한계:
├── 세션 정보 부족
├── 시간적 컨텍스트 없음
├── 시스템 상태 정보 없음
└── 비즈니스 컨텍스트 없음

RL 대응정책에 필요한 특성:
├── 시스템 부하 상태
├── 현재 활성 위협 수
├── 시간대/요일 정보
├── IP 평판 이력
└── 서비스 중요도
```

### **3. 데이터 분할 문제**
```
예상되는 문제:
├── 무작위 분할 사용 (시간 순서 무시)
├── 동일 세션 train/test 분리 위험
├── 데이터 누수 가능성
└── 미래 정보 사용 위험

개선 방향:
├── 시간 기반 분리 (70% 과거 / 30% 미래)
├── 세션 ID 기반 분리
├── 계층적 분할 (공격 유형별)
└── 교차 검증 시 시간 순서 유지
```

---

## **작업 3: 상세 문제점 문서화**

### **현재 시스템의 주요 문제점**

#### **A. 아키텍처 문제**
```
1. 역할 중복:
   - RF: 패킷 분류 + 특성 생성
   - RL: RF 결과 재학습 (불필요)
   
2. 순환 참조:
   - RL이 RF 예측을 정답으로 사용
   - RF 성능 = RL 성능 (평가 불가)
   
3. 실시간 처리 비효율:
   - 개별 패킷마다 RL 추론
   - 시스템 컨텍스트 미고려
```

#### **B. 데이터 문제**
```
1. 부적절한 타겟:
   - protocol_6 (TCP 여부) ≠ 공격 탐지
   - 실제 보안 가치와 무관
   
2. 특성 부족:
   - 정적 패킷 특성만 존재
   - 동적 세션 정보 부재
   - 시간적/공간적 컨텍스트 없음
   
3. 분할 전략:
   - 시간 순서 무시한 무작위 분할
   - 데이터 누수 위험
```

#### **C. 평가 문제**
```
1. 평가 지표 부족:
   - 단순 정확도만 사용
   - 클래스 불균형 미고려
   - 운영 지표 (지연시간, 처리량) 없음
   
2. 일반화 평가 없음:
   - 교차 데이터셋 테스트 없음
   - 미지 공격 대응 능력 미평가
   
3. 실용성 평가 없음:
   - 비즈니스 임팩트 미측정
   - 운영 비용 고려 없음
```

---

## **1주차 완료 상태 업데이트**

### **✅ 완료된 작업 (100%)**
```
1. IDS → IPS 이름 변경
   ├── 주요 파일명 변경 완료
   ├── 코드 내 텍스트 변경 완료
   ├── 로그 파일명 변경 완료
   └── 문서 업데이트 완료

2. 파이프라인 구조 재설계
   ├── 문제점 분석 완료
   ├── 새로운 구조 설계 완료
   ├── 인터페이스 정의 완료
   └── 구현 계획 완료

3. 데이터 분석 및 문제점 문서화
   ├── 데이터 분석 도구 작성
   ├── 현재 구조 문제점 분석
   ├── 개선 방향 명확화
   └── 상세 문제점 문서화 완료
```

### **📊 1주차 목표 달성률: 100%**

---

## **2주차 시작 준비**

### **즉시 시작 가능한 작업들**
```
1. RF 평가지표 구현 (sklearn 기반)
2. Train/Test 분리 시스템 (시간 기반)
3. RF 출력 구조 변경 (ml_models.py)
4. 중복 패킷 제거 시스템
```

### **준비된 자료**
- IPS_PIPELINE_DESIGN.md (상세 설계)
- IPS_REDESIGN_TODO.md (4주차 계획)
- IPS_DATA_ANALYSIS_REPORT.md (문제점 분석)
- 정리된 코드베이스

**1주차 완료! 이제 2주차 핵심 기능 구현을 시작하시겠습니까?**

어떤 작업부터 시작하시겠나요?
1. **RF 평가지표 구현** (상대적 용이)
2. **Train/Test 분리** (데이터 처리 개선)
3. **RF 출력 구조 변경** (파이프라인 핵심)
